---
// components/Header.astro
interface Props {
  title: string;
  subtitle: string;
  primaryButton: string;
  primaryLink: string;
  secondaryButton?: string;
  secondaryLink?: string;
}

const {
  title,
  subtitle,
  primaryButton,
  primaryLink,
  secondaryButton,
  secondaryLink,
} = Astro.props;
---

<header class="header" role="banner">
  <div class="container">
    <nav class="nav" aria-label="Navegación principal">
      <a href="/" class="logo" aria-label="LlakaScript - Inicio">
        <img
          src="/images/llakascript.png"
          alt="LlakaScript Logo"
          class="logo-image"
          width="32"
          height="32"
          loading="eager"
        />
        <span class="logo-text">LlakaScript</span>
      </a>

      <button
        class="menu-toggle"
        id="menuToggle"
        aria-label="Abrir menú"
        aria-expanded="false"
        aria-controls="navMenu"
      >
        <span class="menu-toggle-inner">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </span>
      </button>

      <ul class="nav-menu" id="navMenu" role="menubar">
        <li role="none">
          <a href="#servicios" class="nav-link" role="menuitem">
            <span class="nav-icon" aria-hidden="true">─</span>
            <span class="nav-text">Servicios</span>
          </a>
        </li>
        <li role="none">
          <a href="#nosotros" class="nav-link" role="menuitem">
            <span class="nav-icon" aria-hidden="true">─</span>
            <span class="nav-text">Nosotros</span>
          </a>
        </li>
        <li role="none">
          <a href="#contacto" class="nav-link" role="menuitem">
            <span class="nav-icon" aria-hidden="true">─</span>
            <span class="nav-text">Contacto</span>
          </a>
        </li>
      </ul>

      <div class="nav-overlay" id="navOverlay"></div>
    </nav>
  </div>
</header>

<style>
  /* Variables CSS optimizadas */
  :root {
    --primary: #ff8c00;
    --primary-dark: #e67d00;
    --accent: #10b981;
    --white: #ffffff;
    --text-light: rgba(255, 255, 255, 0.9);
    --text-medium: rgba(255, 255, 255, 0.7);
    --text-dark: rgba(255, 255, 255, 0.5);
    --bg-dark: #0f0c29;
    --bg-transparent: rgba(15, 12, 41, 0.1);
    --bg-blur: rgba(15, 12, 41, 0.85);
    --border-light: rgba(255, 255, 255, 0.1);
    --shadow-subtle: 0 2px 20px rgba(0, 0, 0, 0.1);
    --radius: 8px;
    --max-width: min(1280px, 90vw);
    --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  /* Reset optimizado */
  .header * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  /* Header con mejor rendimiento */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: var(--bg-transparent);
    z-index: 1000;
    padding: 1.5rem 0;
    transition: var(--transition);
    border-bottom: 1px solid transparent;
    will-change: transform, background, padding;
  }

  .header.scrolled {
    background: var(--bg-blur);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-light);
    box-shadow: var(--shadow-subtle);
  }

  .container {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 0 clamp(1rem, 3vw, 2rem);
  }

  /* Navegación optimizada */
  .nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
  }

  /* Logo con mejor rendimiento */
  .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: var(--transition);
    padding: 0.5rem;
    border-radius: var(--radius);
    position: relative;
    overflow: hidden;
  }

  .logo:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.05);
  }

  .logo-image {
    height: 2rem;
    width: auto;
    transition:
      transform 0.3s ease,
      filter 0.3s ease;
    filter: brightness(0.9);
    will-change: transform, filter;
  }

  .logo:hover .logo-image {
    filter: brightness(1.2);
    transform: scale(1.05) rotate(5deg);
  }

  .logo-text {
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--text-light);
    letter-spacing: -0.02em;
    transition:
      color 0.3s ease,
      transform 0.3s ease;
    will-change: color, transform;
  }

  .logo:hover .logo-text {
    color: var(--primary);
    transform: translateX(2px);
  }

  /* Menú de navegación optimizado */
  .nav-menu {
    display: flex;
    list-style: none;
    gap: 2rem;
    margin: 0;
    padding: 0;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: var(--text-medium);
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .nav-link:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.05);
  }

  .nav-icon {
    font-size: 1.1rem;
    font-weight: 300;
    color: var(--text-dark);
    transition: var(--transition);
    min-width: 1rem;
    will-change: transform, color;
  }

  .nav-text {
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--text-medium);
    transition: var(--transition);
    letter-spacing: 0.02em;
    will-change: color, transform;
  }

  .nav-link:hover .nav-icon,
  .nav-link:hover .nav-text,
  .nav-link:focus .nav-icon,
  .nav-link:focus .nav-text {
    color: var(--text-light);
    transform: translateY(-1px);
  }

  .nav-link:hover .nav-icon {
    transform: translateX(2px) scale(1.2);
    color: var(--primary);
  }

  /* Efecto de subrayado optimizado */
  .nav-link::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent,
      var(--primary),
      transparent
    );
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    transform: translateX(-50%);
    will-change: width;
  }

  .nav-link:hover::after {
    width: 80%;
  }

  /* Botón menú móvil optimizado - CORREGIDO */
  .menu-toggle {
    display: none;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    width: 44px;
    height: 44px;
    position: relative;
    z-index: 1002;
    transition: var(--transition);
  }

  .menu-toggle:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius);
  }

  .menu-toggle-inner {
    display: flex;
    flex-direction: column;
    gap: 4px;
    width: 20px;
    height: 16px;
    position: relative;
    transition: var(--transition);
    will-change: transform;
  }

  .bar {
    width: 100%;
    height: 2px; /* Aumentado ligeramente para mejor visibilidad */
    background: var(--text-medium);
    transition: var(--transition);
    transform-origin: center;
    will-change: transform, opacity;
  }

  .bar:nth-child(1) {
    transform: translateY(0) rotate(0deg);
  }

  .bar:nth-child(2) {
    opacity: 1;
    transform: scaleX(1);
  }

  .bar:nth-child(3) {
    transform: translateY(0) rotate(0deg);
  }

  /* Overlay para móvil */
  .nav-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    z-index: 999;
    opacity: 0;
    transition: opacity 0.3s ease;
    will-change: opacity;
  }

  /* Responsive Design - MEJORADO */
  @media (max-width: 768px) {
    .menu-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-overlay {
      display: block;
    }

    .nav-menu {
      position: fixed;
      top: 0;
      right: -100%;
      flex-direction: column;
      background: var(--bg-blur);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      width: min(280px, 85vw); /* Reducido ligeramente */
      height: 100vh;
      padding: 5rem 1.5rem 2rem; /* Ajustado padding */
      transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      gap: 0;
      z-index: 1001;
      border-left: 1px solid var(--border-light);
      will-change: right;
    }

    .nav-menu.active {
      right: 0;
    }

    .nav-overlay.active {
      opacity: 1;
    }

    .nav-menu li {
      border-bottom: 1px solid var(--border-light);
      opacity: 0;
      transform: translateX(20px);
      transition: all 0.3s ease;
      will-change: opacity, transform;
    }

    .nav-menu.active li {
      opacity: 1;
      transform: translateX(0);
    }

    .nav-menu.active li:nth-child(1) {
      transition-delay: 0.1s;
    }
    .nav-menu.active li:nth-child(2) {
      transition-delay: 0.15s;
    }
    .nav-menu.active li:nth-child(3) {
      transition-delay: 0.2s;
    }

    .nav-link {
      padding: 1rem 0; /* Ajustado padding */
      justify-content: flex-start;
      gap: 0.75rem; /* Reducido gap */
    }

    .nav-text {
      font-size: 1rem; /* Tamaño de fuente más apropiado */
      font-weight: 500;
    }

    .nav-icon {
      font-size: 1.1rem; /* Tamaño de icono más apropiado */
      min-width: 1.2rem;
    }

    /* Animación del ícono de hamburguesa - CORREGIDA */
    .menu-toggle.active .bar:nth-child(1) {
      transform: translateY(6px) rotate(45deg);
      background: var(--primary);
    }

    .menu-toggle.active .bar:nth-child(2) {
      opacity: 0;
      transform: scaleX(0);
    }

    .menu-toggle.active .bar:nth-child(3) {
      transform: translateY(-6px) rotate(-45deg);
      background: var(--primary);
    }
  }

  /* Animaciones de entrada optimizadas */
  @keyframes slideDown {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .header {
    animation: slideDown 0.5s ease-out;
  }

  /* Mejoras de accesibilidad */
  @media (prefers-reduced-motion: reduce) {
    .header,
    .logo,
    .nav-link,
    .menu-toggle,
    .bar {
      transition: none;
      animation: none;
    }

    .nav-link::after {
      display: none;
    }

    .header.scrolled {
      backdrop-filter: none;
    }
  }

  @media (prefers-contrast: high) {
    .nav-link {
      border: 1px solid transparent;
    }

    .nav-link:hover {
      border-color: var(--primary);
    }
  }

  /* Focus visible mejorado */
  .nav-link:focus-visible,
  .menu-toggle:focus-visible,
  .logo:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
    border-radius: var(--radius);
  }

  /* Prevenir scroll cuando el menú está abierto */
  body.menu-open {
    overflow: hidden;
  }
</style>

<script>
  // JavaScript optimizado y corregido
  document.addEventListener("DOMContentLoaded", function () {
    "use strict";

    // Elementos del DOM
    const header: any = document.querySelector(".header");
    const menuToggle: any = document.getElementById("menuToggle");
    const navMenu: any = document.getElementById("navMenu");
    const navOverlay: any = document.getElementById("navOverlay");
    const body: any = document.body;

    // Verificar que los elementos existen
    if (!header || !menuToggle || !navMenu || !navOverlay) return;

    // Estado del menú
    let isMenuOpen: any = false;
    let scrollTimeout: any = null;

    // Manejar el scroll del header con throttling mejorado
    function handleScroll() {
      if (!scrollTimeout) {
        scrollTimeout = setTimeout(function () {
          scrollTimeout = null;
          const scrolled: any = window.scrollY > 30;
          header.classList.toggle("scrolled", scrolled);
        }, 10);
      }
    }

    // Abrir/cerrar menú
    function toggleMenu() {
      isMenuOpen = !isMenuOpen;

      // Actualizar estado ARIA
      menuToggle.setAttribute("aria-expanded", isMenuOpen);
      navMenu.setAttribute("aria-expanded", isMenuOpen);

      // Toggle clases
      menuToggle.classList.toggle("active", isMenuOpen);
      navMenu.classList.toggle("active", isMenuOpen);
      navOverlay.classList.toggle("active", isMenuOpen);
      body.classList.toggle("menu-open", isMenuOpen);
    }

    // Cerrar menú
    function closeMenu() {
      if (isMenuOpen) {
        isMenuOpen = false;
        menuToggle.setAttribute("aria-expanded", "false");
        navMenu.setAttribute("aria-expanded", "false");
        menuToggle.classList.remove("active");
        navMenu.classList.remove("active");
        navOverlay.classList.remove("active");
        body.classList.remove("menu-open");
      }
    }

    // Cerrar menú al hacer clic fuera
    function handleClickOutside(event:any) {
      if (
        isMenuOpen &&
        !navMenu.contains(event.target) &&
        !menuToggle.contains(event.target)
      ) {
        closeMenu();
      }
    }

    // Cerrar menú con tecla Escape
    function handleEscapeKey(event:any) {
      if (event.key === "Escape" && isMenuOpen) {
        closeMenu();
        menuToggle.focus();
      }
    }

    // Event listeners optimizados
    window.addEventListener("scroll", handleScroll, { passive: true });
    menuToggle.addEventListener("click", toggleMenu);
    navOverlay.addEventListener("click", closeMenu);
    document.addEventListener("click", handleClickOutside);
    document.addEventListener("keydown", handleEscapeKey);

    // Cerrar menú al hacer clic en enlaces
    const navLinks = document.querySelectorAll(".nav-link");
    navLinks.forEach((link) => {
      link.addEventListener("click", closeMenu);
    });

    // Cleanup mejorado
    window.addEventListener("beforeunload", function () {
      window.removeEventListener("scroll", handleScroll);
      menuToggle.removeEventListener("click", toggleMenu);
      navOverlay.removeEventListener("click", closeMenu);
      document.removeEventListener("click", handleClickOutside);
      document.removeEventListener("keydown", handleEscapeKey);

      navLinks.forEach((link) => {
        link.removeEventListener("click", closeMenu);
      });
    });
  });
</script>
